generator client {
  provider     = "prisma-client-js"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  admin
  user
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  password  String
  role      Role     @default(user)

  branchId  Int?
   branch    Branch?  @relation("BranchUsers", fields: [branchId], references: [id])

     // User can be admin of a branch
  adminOf   Branch[]  @relation("BranchAdmin")

  createdAt DateTime @default(now())
 updatedAt DateTime @default(now()) @updatedAt
}


// ============================
// Branch
// ============================

model Branch {
  id        Int      @id @default(autoincrement())

  adminId   Int
  admin     User     @relation("BranchAdmin", fields: [adminId], references: [id])

  users     User[]   @relation("BranchUsers")

  departments Department[] @relation("DepartmentBranches")
  positions   Position [] 
  employees   Employee[]

  name      String   @unique
  email     String   
  address   String
  contact   String?
  logo      String? 
  city      String
  state     String

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}


model Department {
  id Int @id @default(autoincrement())

  dept_name String @unique

   // Many-to-many relation with Branch
   branches  Branch[] @relation("DepartmentBranches")

   //one to many relation
  positions Position[]
  employees Employee[]


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

    @@map("departments")
}


model Position {
  id Int @id @default(autoincrement())

  pos_name String 

  branchId Int
  branch   Branch @relation(fields: [branchId], references: [id])

  departmentId Int
  department   Department @relation(fields: [departmentId], references: [id])

   employees Employee[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

    @@map("positions")

}



model Employee {
  id Int @id @default(autoincrement())

  empId String @unique
  emp_name String
  email String?
  phone String?
  gender String
  dateOfBirth DateTime?
  dateOfJoining DateTime?
  salary Float?
  address String?


  branchId Int
  branch   Branch @relation(fields: [branchId], references: [id])

  departmentId Int
  department   Department @relation(fields: [departmentId], references: [id])

  posistionId Int
  position Position @relation(fields: [posistionId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

    @@map("employees")

}

